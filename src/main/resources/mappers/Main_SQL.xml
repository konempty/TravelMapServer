<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="main">


    <select id="selectBoardList" resultType="hashmap">
        Select current_date()
        from dual;
    </select>
    <select id="getUser" parameterType="String" resultType="UserVO">
        SELECT id, uid, nickname, DATE_FORMAT(regTime, '%Y-%m-%d %T') as reg_time
        from UserTable
        where uid = #{uid};
    </select>
    <select id="checkNickname" parameterType="String" resultType="int">
        SELECT count(id)
        from UserTable
        where nickname = #{nickname};
    </select>
    <insert id="registerUser" parameterType="UserVO">
        INSERT INTO UserTable(uid, nickname, regTime)
        VALUES (#{uid}, #{nickname}, now());
    </insert>
    <delete id="deleteUser" parameterType="UserVO">
        delete
        from UserTable
        where id = #{id}
          and uid = #{uid};
    </delete>


    <insert id="insertTracking" parameterType="TrackingVO">
        INSERT INTO trackingtable(userID, shareNum, salt, trackingName, filename, regTime)
        VALUES (#{userID}, #{shareNum}, #{salt}, #{trackingName}, #{filename}, now());
    </insert>
    <select id="getTracking" parameterType="hashmap" resultType="TrackingVO">
        SELECT id, userID, shareNum, salt, trackingName,
        <if test="userid != -1">filename,</if>
        DATE_FORMAT(regTime, '%Y-%m-%d %T') as reg_time
        from trackingtable
        where id = #{id}
        <if test="userid != -1">and (shareNum!=2 or
            <if test="userid != 0">userID =
                #{userid}
            </if><!--or #{userid} in (select user2 from friendstable where user1 = userID)-->
            )
        </if>
        ;
    </select>
    <select id="getMaxTrackingID" resultType="int">
        SELECT max(id)
        from trackingtable;
    </select>
    <delete id="deleteTracking" parameterType="TrackingVO">
        delete
        from trackingtable
        where id = #{id}
          and userID = #{userID};
    </delete>
</mapper>

